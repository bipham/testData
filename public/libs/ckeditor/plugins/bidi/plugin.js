!function(){function e(e,t){var r,n=e.config.useComputedState;if((n=void 0===n||n)||(r=i(t.lastElement,e.editable())),(r=r||t.block||t.blockLimit).equals(e.editable())){var o=e.getSelection().getRanges()[0].getEnclosedNode();o&&o.type==CKEDITOR.NODE_ELEMENT&&(r=o)}if(r){var a=n?r.getComputedStyle("direction"):r.getStyle("direction")||r.getAttribute("dir");e.getCommand("bidirtl").setState("rtl"==a?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),e.getCommand("bidiltr").setState("ltr"==a?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}}function t(e,t){var i=(t.block||t.blockLimit||e.editable()).getDirection(1);i!=(e._.selDir||e.lang.dir)&&(e._.selDir=i,e.fire("contentDirChanged",i))}function i(e,t){for(;e&&!(e.getName()in c||e.equals(t));){var i=e.getParent();if(!i)break;e=i}return e}function r(e,t,i,r){if(!e.isReadOnly()&&!e.equals(i.editable())){CKEDITOR.dom.element.setMarker(r,e,"bidi_processed",1);for(var n=e,o=i.editable();(n=n.getParent())&&!n.equals(o);)if(n.getCustomData("bidi_processed"))return e.removeStyle("direction"),void e.removeAttribute("dir");var a="useComputedState"in i.config?i.config.useComputedState:1;(a?e.getComputedStyle("direction"):e.getStyle("direction")||e.hasAttribute("dir"))!=t&&(e.removeStyle("direction"),a?(e.removeAttribute("dir"),t!=e.getComputedStyle("direction")&&e.setAttribute("dir",t)):e.setAttribute("dir",t),i.forceNextSelectionCheck())}}function n(e,t,i){var r=e.getCommonAncestor(!1,!0);if((e=e.clone()).enlarge(i==CKEDITOR.ENTER_BR?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),e.checkBoundaryOfElement(r,CKEDITOR.START)&&e.checkBoundaryOfElement(r,CKEDITOR.END)){for(var n;r&&r.type==CKEDITOR.NODE_ELEMENT&&(n=r.getParent())&&1==n.getChildCount()&&!(r.getName()in t);)r=n;return r.type==CKEDITOR.NODE_ELEMENT&&r.getName()in t&&r}}function o(i){return{context:"p",allowedContent:{"h1 h2 h3 h4 h5 h6 table ul ol blockquote div tr p div li td":{propertiesOnly:!0,attributes:"dir"}},requiredContent:"p[dir]",refresh:function(i,r){e(i,r),t(i,r)},exec:function(e){var t=e.getSelection(),o=e.config.enterMode,a=t.getRanges();if(a&&a.length){for(var c,u={},s=t.createBookmarks(),E=a.createIterator(),g=0;c=E.getNextRange(1);){var T=c.getEnclosedNode();T&&(!T||T.type==CKEDITOR.NODE_ELEMENT&&T.getName()in l)||(T=n(c,d,o)),T&&r(T,i,e,u);var f,C,O=new CKEDITOR.dom.walker(c),m=s[g].startNode,R=s[g++].endNode;for(O.evaluator=function(e){function t(e){return!!e&&e.type==CKEDITOR.NODE_ELEMENT}var i=o==CKEDITOR.ENTER_P?"p":"div";return!(!t(e)||!function(e){return e.getName()in d}(e)||e.is(i)&&t(e.getParent())&&e.getParent().is("blockquote")||!(e.getPosition(m)&CKEDITOR.POSITION_FOLLOWING)||(e.getPosition(R)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_CONTAINS)!=CKEDITOR.POSITION_PRECEDING)};C=O.next();)r(C,i,e,u);for((f=c.createIterator()).enlargeBr=o!=CKEDITOR.ENTER_BR;C=f.getNextParagraph(o==CKEDITOR.ENTER_P?"p":"div");)r(C,i,e,u)}CKEDITOR.dom.element.clearAllMarkers(u),e.forceNextSelectionCheck(),t.selectBookmarks(s),e.focus()}}}}function a(e){for(var t=e.getDocument().getBody().getParent();e;){if(e.equals(t))return!1;e=e.getParent()}return!0}var d={table:1,ul:1,ol:1,blockquote:1,div:1},l={},c={};CKEDITOR.tools.extend(l,d,{tr:1,p:1,div:1,li:1}),CKEDITOR.tools.extend(c,l,{td:1}),CKEDITOR.plugins.add("bidi",{lang:"af,ar,az,bg,bn,bs,ca,cs,cy,da,de,de-ch,el,en,en-au,en-ca,en-gb,eo,es,es-mx,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,oc,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"bidiltr,bidirtl",hidpi:!0,init:function(e){function t(t,i,r,n,o){e.addCommand(r,new CKEDITOR.command(e,n)),e.ui.addButton&&e.ui.addButton(t,{label:i,command:r,toolbar:"bidi,"+o})}if(!e.blockless){var i=e.lang.bidi;t("BidiLtr",i.ltr,"bidiltr",o("ltr"),10),t("BidiRtl",i.rtl,"bidirtl",o("rtl"),20),e.on("contentDom",function(){e.document.on("dirChanged",function(t){e.fire("dirChanged",{node:t.data,dir:t.data.getDirection(1)})})}),e.on("contentDirChanged",function(t){var i=(e.lang.dir!=t.data?"add":"remove")+"Class",r=e.ui.space(e.config.toolbarLocation);r&&r[i]("cke_mixed_dir_content")})}}});for(var u=CKEDITOR.dom.element.prototype,s=["setStyle","removeStyle","setAttribute","removeAttribute"],E=0;E<s.length;E++)u[s[E]]=CKEDITOR.tools.override(u[s[E]],function(e){var t=e==u.setAttribute,i=e==u.removeAttribute,r=/\bdirection\s*:\s*(.*?)\s*(:?$|;)/;return function(n,o){if(!this.isReadOnly()){var d;if((n==(t||i?"dir":"direction")||"style"==n&&(i||r.test(o)))&&!a(this)){d=this.getDirection(1);var l=e.apply(this,arguments);if(d!=this.getDirection(1))return this.getDocument().fire("dirChanged",this),l}}return e.apply(this,arguments)}})}();