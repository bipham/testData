!function(){function e(e,t){function l(e){return!t||t.contains(e)&&e.getAscendant("table",!0).equals(t)}if(e){for(var n=e.getRanges(),r=[],o={},a=0;a<n.length;a++){var c=n[a];if(c.collapsed){var i=c.getCommonAncestor().getAscendant({td:1,th:1},!0);i&&l(i)&&r.push(i)}else{var s,u=new CKEDITOR.dom.walker(c);for(u.guard=function(e){r.length>0||e.type==CKEDITOR.NODE_ELEMENT&&I.test(e.getName())&&!e.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(o,e,"selected_cell",!0),r.push(e))};s=u.next();)if(s.type!=CKEDITOR.NODE_ELEMENT||!s.is(CKEDITOR.dtd.table)){var d=s.getAscendant({td:1,th:1},!0);d&&!d.getCustomData("selected_cell")&&l(d)&&(CKEDITOR.dom.element.setMarker(o,d,"selected_cell",!0),r.push(d))}}}return CKEDITOR.dom.element.clearAllMarkers(o),r}}function t(e){for(var t,l,n,r=0,o=e.length-1,a={};t=e[r++];)CKEDITOR.dom.element.setMarker(a,t,"delete_cell",!0);for(r=0;t=e[r++];)if((l=t.getPrevious())&&!l.getCustomData("delete_cell")||(l=t.getNext())&&!l.getCustomData("delete_cell"))return CKEDITOR.dom.element.clearAllMarkers(a),l;return CKEDITOR.dom.element.clearAllMarkers(a),n=e[0].getParent(),(n=n.getPrevious())?n.getLast():(n=e[o].getParent(),(n=n.getNext())?n.getChild(0):null)}function l(t,l){for(var n=b(t)?t:e(t),r=n[0],o=r.getAscendant("table"),a=r.getDocument(),c=n[0].getParent(),i=c.$.rowIndex,s=n[n.length-1],u=s.getParent().$.rowIndex+s.$.rowSpan-1,d=new CKEDITOR.dom.element(o.$.rows[u]),g=l?i:u,m=l?c:d,T=CKEDITOR.tools.buildTableMap(o),f=T[g],p=l?T[g-1]:T[g+1],I=T[0].length,E=a.createElement("tr"),C=0;f[C]&&C<I;C++){var R;f[C].rowSpan>1&&p&&f[C]==p[C]?(R=f[C]).rowSpan+=1:((R=new CKEDITOR.dom.element(f[C]).clone()).removeAttribute("rowSpan"),R.appendBogus(),E.append(R),R=R.$),C+=R.colSpan-1}l?E.insertBefore(m):E.insertAfter(m)}function n(t){if(t instanceof CKEDITOR.dom.selection){var l=t.getRanges(),r=e(t),o=r[0].getAscendant("table"),a=CKEDITOR.tools.buildTableMap(o),c=r[0].getParent().$.rowIndex,i=r[r.length-1],s=i.getParent().$.rowIndex+i.$.rowSpan-1,u=[];t.reset();for(var d=c;d<=s;d++){for(var g=a[d],m=new CKEDITOR.dom.element(o.$.rows[d]),T=0;T<g.length;T++){var f=new CKEDITOR.dom.element(g[T]),p=f.getParent().$.rowIndex;if(1==f.$.rowSpan)f.remove();else if(f.$.rowSpan-=1,p==d){var I=a[d+1];I[T-1]?f.insertAfter(new CKEDITOR.dom.element(I[T-1])):new CKEDITOR.dom.element(o.$.rows[d+1]).append(f,1)}T+=f.$.colSpan-1}u.push(m)}var b=o.$.rows;l[0].moveToPosition(o,CKEDITOR.POSITION_BEFORE_START);var E=new CKEDITOR.dom.element(b[s+1]||(c>0?b[c-1]:null)||o.$.parentNode);for(d=u.length;d>=0;d--)n(u[d]);return o.$.parentNode?E:(l[0].select(),null)}return t instanceof CKEDITOR.dom.element&&(1==(o=t.getAscendant("table")).$.rows.length?o.remove():t.remove()),null}function r(e,t){for(var l=e.getParent().$.cells,n=0,r=0;r<l.length;r++){var o=l[r];if(n+=t?1:o.colSpan,o==e.$)break}return n-1}function o(e,t){for(var l=t?1/0:0,n=0;n<e.length;n++){var o=r(e[n],t);(t?o<l:o>l)&&(l=o)}return l}function a(t,l){for(var n,r=b(t)?t:e(t),a=r[0].getAscendant("table"),c=o(r,1),i=o(r),s=l?c:i,u=CKEDITOR.tools.buildTableMap(a),d=[],g=[],m=u.length,T=0;T<m;T++){d.push(u[T][s]);var f=l?u[T][s-1]:u[T][s+1];g.push(f)}for(T=0;T<m;T++){var p;d[T]&&(d[T].colSpan>1&&g[T]==d[T]?(p=d[T]).colSpan+=1:((p=(n=new CKEDITOR.dom.element(d[T])).clone()).removeAttribute("colSpan"),p.appendBogus(),p[l?"insertBefore":"insertAfter"].call(p,n),p=p.$),T+=p.rowSpan-1)}}function c(t){var l,n,r=t.getRanges(),o=e(t),a=o[0],c=o[o.length-1],i=a.getAscendant("table"),s=CKEDITOR.tools.buildTableMap(i),u=[];t.reset();for(var d=0,g=s.length;d<g;d++)for(var m=0,T=s[d].length;m<T;m++)s[d][m]==a.$&&(l=m),s[d][m]==c.$&&(n=m);for(d=l;d<=n;d++)for(m=0;m<s.length;m++){var f=s[m],p=new CKEDITOR.dom.element(i.$.rows[m]),I=new CKEDITOR.dom.element(f[d]);I.$&&(1==I.$.colSpan?I.remove():I.$.colSpan-=1,m+=I.$.rowSpan-1,p.$.cells.length||u.push(p))}var b=i.$.rows[0]&&i.$.rows[0].cells,E=new CKEDITOR.dom.element(b[l]||(l?b[l-1]:i.$.parentNode));return u.length==g&&(r[0].moveToPosition(i,CKEDITOR.POSITION_AFTER_END),r[0].select(),i.remove()),E}function i(e,t){var l=e.getStartElement().getAscendant({td:1,th:1},!0);if(l){var n=l.clone();n.appendBogus(),t?n.insertBefore(l):n.insertAfter(l)}}function s(l){if(l instanceof CKEDITOR.dom.selection){var n=l.getRanges(),r=e(l),o=r[0]&&r[0].getAscendant("table"),a=t(r);l.reset();for(var c=r.length-1;c>=0;c--)s(r[c]);a?d(a,!0):o&&(n[0].moveToPosition(o,CKEDITOR.POSITION_BEFORE_START),n[0].select(),o.remove())}else if(l instanceof CKEDITOR.dom.element){var i=l.getParent();1==i.getChildCount()?i.remove():l.remove()}}function u(e){var t=e.getBogus();t&&t.remove(),e.trim()}function d(e,t){var l=e.getDocument(),n=CKEDITOR.document;CKEDITOR.env.ie&&10==CKEDITOR.env.version&&(n.focus(),l.focus());var r=new CKEDITOR.dom.range(l);r["moveToElementEdit"+(t?"End":"Start")](e)||(r.selectNodeContents(e),r.collapse(!t)),r.select(!0)}function g(e,t,l){var n=e[t];if(void 0===l)return n;for(var r=0;n&&r<n.length;r++){if(l.is&&n[r]==l.$)return r;if(r==l)return new CKEDITOR.dom.element(n[r])}return l.is?-1:null}function m(e,t){for(var l=[],n=0;n<e.length;n++){var r=e[n];l.push(r[t]),r[t].rowSpan>1&&(n+=r[t].rowSpan-1)}return l}function T(t,l,n){var r,o=e(t);if((l?1!=o.length:o.length<2)||(r=t.getCommonAncestor())&&r.type==CKEDITOR.NODE_ELEMENT&&r.is("table"))return!1;var a,c=o[0],i=c.getAscendant("table"),s=CKEDITOR.tools.buildTableMap(i),d=s.length,m=s[0].length,T=c.getParent().$.rowIndex,f=g(s,T,c);if(l){var p;try{var I=parseInt(c.getAttribute("rowspan"),10)||1,b=parseInt(c.getAttribute("colspan"),10)||1;p=s["up"==l?T-I:"down"==l?T+I:T]["left"==l?f-b:"right"==l?f+b:f]}catch(e){return!1}if(!p||c.$==p)return!1;o["up"==l||"left"==l?"unshift":"push"](new CKEDITOR.dom.element(p))}for(var E=c.getDocument(),C=T,R=0,w=0,D=!n&&new CKEDITOR.dom.documentFragment(E),O=0,h=0;h<o.length;h++){var v=(a=o[h]).getParent(),S=a.getFirst(),A=a.$.colSpan,K=a.$.rowSpan,_=v.$.rowIndex,$=g(s,_,a);if(O+=A*K,w=Math.max(w,$-f+A),R=Math.max(R,_-T+K),!n){if(u(a),a.getChildren().count()){if(_!=C&&S&&(!S.isBlockBoundary||!S.isBlockBoundary({br:1}))){var F=D.getLast(CKEDITOR.dom.walker.whitespaces(!0));!F||F.is&&F.is("br")||D.append("br")}a.moveChildren(D)}h?a.remove():a.setHtml("")}C=_}if(n)return R*w==O;D.moveChildren(c),c.appendBogus(),w>=m?c.removeAttribute("rowSpan"):c.$.rowSpan=R,R>=d?c.removeAttribute("colSpan"):c.$.colSpan=w;var B=new CKEDITOR.dom.nodeList(i.$.rows),x=B.count();for(h=x-1;h>=0;h--){var M=B.getItem(h);M.$.cells.length||(M.remove(),x++)}return c}function f(t,l){var n=e(t);if(n.length>1)return!1;if(l)return!0;var r,o,a,c,i=n[0],s=i.getParent(),u=s.getAscendant("table"),d=CKEDITOR.tools.buildTableMap(u),m=s.$.rowIndex,T=g(d,m,i),f=i.$.rowSpan;if(f>1){o=Math.ceil(f/2),a=Math.floor(f/2),c=m+o;var p,I=new CKEDITOR.dom.element(u.$.rows[c]),b=g(d,c);r=i.clone();for(var E=0;E<b.length;E++){if((p=b[E]).parentNode==I.$&&E>T){r.insertBefore(new CKEDITOR.dom.element(p));break}p=null}p||I.append(r)}else{a=o=1,(I=s.clone()).insertAfter(s),I.append(r=i.clone());for(var C=g(d,m),R=0;R<C.length;R++)C[R].rowSpan++}return r.appendBogus(),i.$.rowSpan=o,r.$.rowSpan=a,1==o&&i.removeAttribute("rowSpan"),1==a&&r.removeAttribute("rowSpan"),r}function p(t,l){var n=e(t);if(n.length>1)return!1;if(l)return!0;var r,o,a,c=n[0],i=c.getParent(),s=i.getAscendant("table"),u=CKEDITOR.tools.buildTableMap(s),d=g(u,i.$.rowIndex,c),T=c.$.colSpan;if(T>1)o=Math.ceil(T/2),a=Math.floor(T/2);else{a=o=1;for(var f=m(u,d),p=0;p<f.length;p++)f[p].colSpan++}return(r=c.clone()).insertAfter(c),r.appendBogus(),c.$.colSpan=o,r.$.colSpan=a,1==o&&c.removeAttribute("colSpan"),1==a&&r.removeAttribute("colSpan"),r}var I=/^(?:td|th)$/,b=CKEDITOR.tools.isArray;CKEDITOR.plugins.tabletools={requires:"table,dialog,contextmenu",init:function(t){function r(e){return CKEDITOR.tools.extend(e||{},{contextSensitive:1,refresh:function(e,t){this.setState(t.contains({td:1,th:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}function o(e,l){var n=t.addCommand(e,l);t.addFeature(n)}var u=t.lang.table,g=CKEDITOR.tools.style.parse;o("cellProperties",new CKEDITOR.dialogCommand("cellProperties",r({allowedContent:"td th{width,height,border-color,background-color,white-space,vertical-align,text-align}[colspan,rowspan]",requiredContent:"table",contentTransformations:[[{element:"td",left:function(e){return e.styles.background&&g.background(e.styles.background).color},right:function(e){e.styles["background-color"]=g.background(e.styles.background).color}},{element:"td",check:"td{vertical-align}",left:function(e){return e.attributes&&e.attributes.valign},right:function(e){e.styles["vertical-align"]=e.attributes.valign,delete e.attributes.valign}}],[{element:"tr",check:"td{height}",left:function(e){return e.styles&&e.styles.height},right:function(e){CKEDITOR.tools.array.forEach(e.children,function(t){t.name in{td:1,th:1}&&(t.attributes["cke-row-height"]=e.styles.height)}),delete e.styles.height}}],[{element:"td",check:"td{height}",left:function(e){var t=e.attributes;return t&&t["cke-row-height"]},right:function(e){e.styles.height=e.attributes["cke-row-height"],delete e.attributes["cke-row-height"]}}]]}))),CKEDITOR.dialog.add("cellProperties",this.path+"dialogs/tableCell.js"),o("rowDelete",r({requiredContent:"table",exec:function(e){var t=n(e.getSelection());t&&d(t)}})),o("rowInsertBefore",r({requiredContent:"table",exec:function(t){l(e(t.getSelection()),!0)}})),o("rowInsertAfter",r({requiredContent:"table",exec:function(t){l(e(t.getSelection()))}})),o("columnDelete",r({requiredContent:"table",exec:function(e){var t=c(e.getSelection());t&&d(t,!0)}})),o("columnInsertBefore",r({requiredContent:"table",exec:function(t){a(e(t.getSelection()),!0)}})),o("columnInsertAfter",r({requiredContent:"table",exec:function(t){a(e(t.getSelection()))}})),o("cellDelete",r({requiredContent:"table",exec:function(e){s(e.getSelection())}})),o("cellMerge",r({allowedContent:"td[colspan,rowspan]",requiredContent:"td[colspan,rowspan]",exec:function(e,t){t.cell=T(e.getSelection()),d(t.cell,!0)}})),o("cellMergeRight",r({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e,t){t.cell=T(e.getSelection(),"right"),d(t.cell,!0)}})),o("cellMergeDown",r({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e,t){t.cell=T(e.getSelection(),"down"),d(t.cell,!0)}})),o("cellVerticalSplit",r({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e){d(p(e.getSelection()))}})),o("cellHorizontalSplit",r({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e){d(f(e.getSelection()))}})),o("cellInsertBefore",r({requiredContent:"table",exec:function(e){i(e.getSelection(),!0)}})),o("cellInsertAfter",r({requiredContent:"table",exec:function(e){i(e.getSelection())}})),t.addMenuItems&&t.addMenuItems({tablecell:{label:u.cell.menu,group:"tablecell",order:1,getItems:function(){var l=t.getSelection(),n=e(l);return{tablecell_insertBefore:CKEDITOR.TRISTATE_OFF,tablecell_insertAfter:CKEDITOR.TRISTATE_OFF,tablecell_delete:CKEDITOR.TRISTATE_OFF,tablecell_merge:T(l,null,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_right:T(l,"right",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_down:T(l,"down",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_vertical:p(l,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_horizontal:f(l,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_properties:n.length>0?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}}},tablecell_insertBefore:{label:u.cell.insertBefore,group:"tablecell",command:"cellInsertBefore",order:5},tablecell_insertAfter:{label:u.cell.insertAfter,group:"tablecell",command:"cellInsertAfter",order:10},tablecell_delete:{label:u.cell.deleteCell,group:"tablecell",command:"cellDelete",order:15},tablecell_merge:{label:u.cell.merge,group:"tablecell",command:"cellMerge",order:16},tablecell_merge_right:{label:u.cell.mergeRight,group:"tablecell",command:"cellMergeRight",order:17},tablecell_merge_down:{label:u.cell.mergeDown,group:"tablecell",command:"cellMergeDown",order:18},tablecell_split_horizontal:{label:u.cell.splitHorizontal,group:"tablecell",command:"cellHorizontalSplit",order:19},tablecell_split_vertical:{label:u.cell.splitVertical,group:"tablecell",command:"cellVerticalSplit",order:20},tablecell_properties:{label:u.cell.title,group:"tablecellproperties",command:"cellProperties",order:21},tablerow:{label:u.row.menu,group:"tablerow",order:1,getItems:function(){return{tablerow_insertBefore:CKEDITOR.TRISTATE_OFF,tablerow_insertAfter:CKEDITOR.TRISTATE_OFF,tablerow_delete:CKEDITOR.TRISTATE_OFF}}},tablerow_insertBefore:{label:u.row.insertBefore,group:"tablerow",command:"rowInsertBefore",order:5},tablerow_insertAfter:{label:u.row.insertAfter,group:"tablerow",command:"rowInsertAfter",order:10},tablerow_delete:{label:u.row.deleteRow,group:"tablerow",command:"rowDelete",order:15},tablecolumn:{label:u.column.menu,group:"tablecolumn",order:1,getItems:function(){return{tablecolumn_insertBefore:CKEDITOR.TRISTATE_OFF,tablecolumn_insertAfter:CKEDITOR.TRISTATE_OFF,tablecolumn_delete:CKEDITOR.TRISTATE_OFF}}},tablecolumn_insertBefore:{label:u.column.insertBefore,group:"tablecolumn",command:"columnInsertBefore",order:5},tablecolumn_insertAfter:{label:u.column.insertAfter,group:"tablecolumn",command:"columnInsertAfter",order:10},tablecolumn_delete:{label:u.column.deleteColumn,group:"tablecolumn",command:"columnDelete",order:15}}),t.contextMenu&&t.contextMenu.addListener(function(e,t,l){var n=l.contains({td:1,th:1},1);return n&&!n.isReadOnly()?{tablecell:CKEDITOR.TRISTATE_OFF,tablerow:CKEDITOR.TRISTATE_OFF,tablecolumn:CKEDITOR.TRISTATE_OFF}:null})},getCellColIndex:r,insertRow:l,insertColumn:a,getSelectedCells:e},CKEDITOR.plugins.add("tabletools",CKEDITOR.plugins.tabletools)}(),CKEDITOR.tools.buildTableMap=function(e,t,l,n,r){var o=e.$.rows;t=t||0,l=l||0,n="number"==typeof n?n:o.length-1,r="number"==typeof r?r:-1;for(var a=-1,c=[],i=t;i<=n;i++){!c[++a]&&(c[a]=[]);for(var s=-1,u=l;u<=(-1===r?o[i].cells.length-1:r);u++){var d=o[i].cells[u];if(!d)break;for(s++;c[a][s];)s++;for(var g=isNaN(d.colSpan)?1:d.colSpan,m=isNaN(d.rowSpan)?1:d.rowSpan,T=0;T<m&&!(i+T>n);T++){c[a+T]||(c[a+T]=[]);for(var f=0;f<g;f++)c[a+T][s+f]=o[i].cells[u]}if(s+=g-1,-1!==r&&s>=r)break}}return c};