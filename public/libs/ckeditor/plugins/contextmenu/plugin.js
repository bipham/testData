CKEDITOR.plugins.add("contextmenu",{requires:"menu",lang:"af,ar,az,bg,bn,bs,ca,cs,cy,da,de,de-ch,el,en,en-au,en-ca,en-gb,eo,es,es-mx,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,oc,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(e){this.base.call(this,e,{panel:{className:"cke_menu_panel",attributes:{"aria-label":e.lang.contextmenu.options}}})},proto:{addTarget:function(e,t){if(e.on("contextmenu",function(e){var o=e.data,a=CKEDITOR.env.webkit?n:CKEDITOR.env.mac?o.$.metaKey:o.$.ctrlKey;if(!t||!a){if(o.preventDefault(),CKEDITOR.env.mac&&CKEDITOR.env.webkit){var i=this.editor,c=new CKEDITOR.dom.elementPath(o.getTarget(),i.editable()).contains(function(e){return e.hasAttribute("contenteditable")},!0);c&&"false"==c.getAttribute("contenteditable")&&i.getSelection().fake(c)}var u=o.getTarget().getDocument(),s=o.getTarget().getDocument().getDocumentElement(),l=!u.equals(CKEDITOR.document),r=u.getWindow().getScrollPosition(),m=l?o.$.clientX:o.$.pageX||r.x+o.$.clientX,d=l?o.$.clientY:o.$.pageY||r.y+o.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(s,null,m,d)},CKEDITOR.env.ie?200:0,this)}},this),CKEDITOR.env.webkit){var n,o=function(){n=0};e.on("keydown",function(e){n=CKEDITOR.env.mac?e.data.$.metaKey:e.data.$.ctrlKey}),e.on("keyup",o),e.on("contextmenu",o)}},open:function(e,t,n,o){!1!==this.editor.config.enableContextMenu&&(this.editor.focus(),e=e||CKEDITOR.document.getDocumentElement(),this.editor.selectionChange(1),this.show(e,t,n,o))}}})},beforeInit:function(e){var t=e.contextMenu=new CKEDITOR.plugins.contextMenu(e);e.on("contentDom",function(){t.addTarget(e.editable(),!1!==e.config.browserContextMenuOnCtrl)}),e.addCommand("contextMenu",{exec:function(){e.contextMenu.open(e.document.getBody())}}),e.setKeystroke(CKEDITOR.SHIFT+121,"contextMenu"),e.setKeystroke(CKEDITOR.CTRL+CKEDITOR.SHIFT+121,"contextMenu")}});