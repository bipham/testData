!function(){function e(e,r){var o=[];if(!r)return e;for(var t in r)o.push(t+"="+encodeURIComponent(r[t]));return e+(-1!=e.indexOf("?")?"&":"?")+o.join("&")}function r(e){return(e+="").charAt(0).toUpperCase()+e.substr(1)}function o(){var o=this.getDialog(),t=o.getParentEditor();t._.filebrowserSe=this;var i=t.config["filebrowser"+r(o.getName())+"WindowWidth"]||t.config.filebrowserWindowWidth||"80%",n=t.config["filebrowser"+r(o.getName())+"WindowHeight"]||t.config.filebrowserWindowHeight||"70%",l=this.filebrowser.params||{};l.CKEditor=t.name,l.CKEditorFuncNum=t._.filebrowserFn,l.langCode||(l.langCode=t.langCode);var f=e(this.filebrowser.url,l);t.popup(f,i,n,t.config.filebrowserWindowFeatures||t.config.fileBrowserWindowFeatures)}function t(e){var r,o=new CKEDITOR.dom.element(e.$.form);o&&((r=o.$.elements[d])?r=new CKEDITOR.dom.element(r):((r=new CKEDITOR.dom.element("input")).setAttributes({name:d,type:"hidden"}),o.append(r)),r.setAttribute("value",CKEDITOR.tools.getCsrfToken()))}function i(){var e=this.getDialog();return e.getParentEditor()._.filebrowserSe=this,!!e.getContentElement(this.for[0],this.for[1]).getInputElement().$.value&&!!e.getContentElement(this.for[0],this.for[1]).getAction()}function n(r,o,t){var i=t.params||{};i.CKEditor=r.name,i.CKEditorFuncNum=r._.filebrowserFn,i.langCode||(i.langCode=r.langCode),o.action=e(t.url,i),o.filebrowser=t}function l(e,f,s,a){if(a&&a.length)for(var d,u=a.length;u--;)if("hbox"!=(d=a[u]).type&&"vbox"!=d.type&&"fieldset"!=d.type||l(e,f,s,d.children),d.filebrowser){if("string"==typeof d.filebrowser){var g={action:"fileButton"==d.type?"QuickUpload":"Browse",target:d.filebrowser};d.filebrowser=g}if("Browse"==d.filebrowser.action){var w=d.filebrowser.url;void 0===w&&void 0===(w=e.config["filebrowser"+r(f)+"BrowseUrl"])&&(w=e.config.filebrowserBrowseUrl),w&&(d.onClick=o,d.filebrowser.url=w,d.hidden=!1)}else if("QuickUpload"==d.filebrowser.action&&d.for&&(void 0===(w=d.filebrowser.url)&&void 0===(w=e.config["filebrowser"+r(f)+"UploadUrl"])&&(w=e.config.filebrowserUploadUrl),w)){var c=d.onClick;d.onClick=function(e){var r=e.sender;return!(c&&!1===c.call(r,e)||!i.call(r,e)||(t(r.getDialog().getContentElement(this.for[0],this.for[1]).getInputElement()),0))},d.filebrowser.url=w,d.hidden=!1,n(e,s.getContents(d.for[0]).get(d.for[1]),d.filebrowser)}}}function f(e,r){var o=r.getDialog(),t=r.filebrowser.target||null;if(t){var i=t.split(":"),n=o.getContentElement(i[0],i[1]);n&&(n.setValue(e),o.selectPage(i[0]))}}function s(e,r,o){if(-1!==o.indexOf(";")){for(var t=o.split(";"),i=0;i<t.length;i++)if(s(e,r,t[i]))return!0;return!1}var n=e.getContents(r).get(o).filebrowser;return n&&n.url}function a(e,r){var o=this._.filebrowserSe.getDialog(),t=this._.filebrowserSe.for,i=this._.filebrowserSe.filebrowser.onSelect;t&&o.getContentElement(t[0],t[1]).reset(),"function"==typeof r&&!1===r.call(this._.filebrowserSe)||i&&!1===i.call(this._.filebrowserSe,e,r)||("string"==typeof r&&r&&alert(r),e&&f(e,this._.filebrowserSe))}var d="ckCsrfToken";CKEDITOR.plugins.add("filebrowser",{requires:"popup",init:function(e){e._.filebrowserFn=CKEDITOR.tools.addFunction(a,e),e.on("destroy",function(){CKEDITOR.tools.removeFunction(this._.filebrowserFn)})}}),CKEDITOR.on("dialogDefinition",function(e){if(e.editor.plugins.filebrowser)for(var r,o=e.data.definition,t=0;t<o.contents.length;++t)(r=o.contents[t])&&(l(e.editor,e.data.name,o,r.elements),r.hidden&&r.filebrowser&&(r.hidden=!s(o,r.id,r.filebrowser)))})}();