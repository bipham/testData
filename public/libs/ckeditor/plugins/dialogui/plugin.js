CKEDITOR.plugins.add("dialogui",{onLoad:function(){var e=function(e){this._||(this._={}),this._.default=this._.initValue=e.default||"",this._.required=e.required||!1;for(var t=[this._],i=1;i<arguments.length;i++)t.push(arguments[i]);return t.push(!0),CKEDITOR.tools.extend.apply(CKEDITOR.tools,t),this._},t={build:function(e,t,i){return new CKEDITOR.ui.dialog.textInput(e,t,i)}},i={build:function(e,t,i){return new CKEDITOR.ui.dialog[t.type](e,t,i)}},l={build:function(e,t,i){for(var l,n=t.children,o=[],a=[],s=0;s<n.length&&(l=n[s]);s++){var u=[];o.push(u),a.push(CKEDITOR.dialog._.uiElementBuilders[l.type].build(e,l,u))}return new CKEDITOR.ui.dialog[t.type](e,a,o,i,t)}},n={isChanged:function(){return this.getValue()!=this.getInitValue()},reset:function(e){this.setValue(this.getInitValue(),e)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._.default},getInitValue:function(){return this._.initValue}},o=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(e,t){this._.domOnChangeRegistered||(e.on("load",function(){this.getInputElement().on("change",function(){e.parts.dialog.isVisible()&&this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",t)}},!0),a=/^on([A-Z]\w+)/,s=function(e){for(var t in e)(a.test(t)||"title"==t||"type"==t)&&delete e[t];return e},u=function(e){var t=e.data.getKeystroke();t==CKEDITOR.SHIFT+CKEDITOR.ALT+36?this.setDirectionMarker("ltr"):t==CKEDITOR.SHIFT+CKEDITOR.ALT+35&&this.setDirectionMarker("rtl")};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(t,i,l,n){if(!(arguments.length<4)){var o=e.call(this,i);o.labelId=CKEDITOR.tools.getNextId()+"_label",this._.children=[];var a={role:i.role||"presentation"};i.includeLabel&&(a["aria-labelledby"]=o.labelId),CKEDITOR.ui.dialog.uiElement.call(this,t,i,l,"div",null,a,function(){var e=[],l=i.required?" cke_required":"";if("horizontal"!=i.labelLayout)e.push('<label class="cke_dialog_ui_labeled_label'+l+'" ',' id="'+o.labelId+'"',o.inputId?' for="'+o.inputId+'"':"",(i.labelStyle?' style="'+i.labelStyle+'"':"")+">",i.label,"</label>",'<div class="cke_dialog_ui_labeled_content"',i.controlStyle?' style="'+i.controlStyle+'"':"",' role="presentation">',n.call(this,t,i),"</div>");else{var a={type:"hbox",widths:i.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+l+'" id="'+o.labelId+'" for="'+o.inputId+'"'+(i.labelStyle?' style="'+i.labelStyle+'"':"")+">"+CKEDITOR.tools.htmlEncode(i.label)+"</label>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content"'+(i.controlStyle?' style="'+i.controlStyle+'"':"")+">"+n.call(this,t,i)+"</span>"}]};CKEDITOR.dialog._.uiElementBuilders.hbox.build(t,a,e)}return e.join("")})}},textInput:function(t,i,l){if(!(arguments.length<3)){e.call(this,i);var n=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",o={class:"cke_dialog_ui_input_"+i.type,id:n,type:i.type};i.validate&&(this.validate=i.validate),i.maxLength&&(o.maxlength=i.maxLength),i.size&&(o.size=i.size),i.inputStyle&&(o.style=i.inputStyle);var a=this,s=!1;t.on("load",function(){a.getInputElement().on("keydown",function(e){13==e.data.getKeystroke()&&(s=!0)}),a.getInputElement().on("keyup",function(e){13==e.data.getKeystroke()&&s&&(t.getButton("ok")&&setTimeout(function(){t.getButton("ok").click()},0),s=!1),a.bidi&&u.call(a,e)},null,null,1e3)}),CKEDITOR.ui.dialog.labeledElement.call(this,t,i,l,function(){var e=['<div class="cke_dialog_ui_input_',i.type,'" role="presentation"'];i.width&&e.push('style="width:'+i.width+'" '),e.push("><input "),o["aria-labelledby"]=this._.labelId,this._.required&&(o["aria-required"]=this._.required);for(var t in o)e.push(t+'="'+o[t]+'" ');return e.push(" /></div>"),e.join("")})}},textarea:function(t,i,l){if(!(arguments.length<3)){e.call(this,i);var n=this,o=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",a={};i.validate&&(this.validate=i.validate),a.rows=i.rows||5,a.cols=i.cols||20,a.class="cke_dialog_ui_input_textarea "+(i.class||""),void 0!==i.inputStyle&&(a.style=i.inputStyle),i.dir&&(a.dir=i.dir),n.bidi&&t.on("load",function(){n.getInputElement().on("keyup",u)},n),CKEDITOR.ui.dialog.labeledElement.call(this,t,i,l,function(){a["aria-labelledby"]=this._.labelId,this._.required&&(a["aria-required"]=this._.required);var e=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea id="',o,'" '];for(var t in a)e.push(t+'="'+CKEDITOR.tools.htmlEncode(a[t])+'" ');return e.push(">",CKEDITOR.tools.htmlEncode(n._.default),"</textarea></div>"),e.join("")})}},checkbox:function(t,i,l){if(!(arguments.length<3)){var n=e.call(this,i,{default:!!i.default});i.validate&&(this.validate=i.validate),CKEDITOR.ui.dialog.uiElement.call(this,t,i,l,"span",null,null,function(){var e=CKEDITOR.tools.extend({},i,{id:i.id?i.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},!0),l=[],o=CKEDITOR.tools.getNextId()+"_label",a={class:"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":o};return s(e),i.default&&(a.checked="checked"),void 0!==e.inputStyle&&(e.style=e.inputStyle),n.checkbox=new CKEDITOR.ui.dialog.uiElement(t,e,l,"input",null,a),l.push(' <label id="',o,'" for="',a.id,'"'+(i.labelStyle?' style="'+i.labelStyle+'"':"")+">",CKEDITOR.tools.htmlEncode(i.label),"</label>"),l.join("")})}},radio:function(t,i,l){if(!(arguments.length<3)){e.call(this,i),this._.default||(this._.default=this._.initValue=i.items[0][1]),i.validate&&(this.validate=i.validate);var n=[],o=this;i.role="radiogroup",i.includeLabel=!0,CKEDITOR.ui.dialog.labeledElement.call(this,t,i,l,function(){for(var e=[],l=[],a=(i.id?i.id:CKEDITOR.tools.getNextId())+"_radio",u=0;u<i.items.length;u++){var d=i.items[u],r=void 0!==d[2]?d[2]:d[0],c=void 0!==d[1]?d[1]:d[0],h=CKEDITOR.tools.getNextId()+"_radio_input",g=h+"_label",E=CKEDITOR.tools.extend({},i,{id:h,title:null,type:null},!0),I=CKEDITOR.tools.extend({},E,{title:r},!0),f={type:"radio",class:"cke_dialog_ui_radio_input",name:a,value:c,"aria-labelledby":g},p=[];o._.default==c&&(f.checked="checked"),s(E),s(I),void 0!==E.inputStyle&&(E.style=E.inputStyle),E.keyboardFocusable=!0,n.push(new CKEDITOR.ui.dialog.uiElement(t,E,p,"input",null,f)),p.push(" "),new CKEDITOR.ui.dialog.uiElement(t,I,p,"label",null,{id:g,for:f.id},d[0]),e.push(p.join(""))}return new CKEDITOR.ui.dialog.hbox(t,n,e,l),l.join("")}),this._.children=n}},button:function(t,i,l){if(arguments.length){"function"==typeof i&&(i=i(t.getParentEditor())),e.call(this,i,{disabled:i.disabled||!1}),CKEDITOR.event.implementOn(this);var n=this;t.on("load",function(){var e=this.getElement();e.on("click",function(e){n.click(),e.data.preventDefault()}),e.on("keydown",function(e){e.data.getKeystroke()in{32:1}&&(n.click(),e.data.preventDefault())}),e.unselectable()},this);var o=CKEDITOR.tools.extend({},i);delete o.style;var a=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,t,o,l,"a",null,{style:i.style,href:"javascript:void(0)",title:i.label,hidefocus:"true",class:i.class,role:"button","aria-labelledby":a},'<span id="'+a+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(i.label)+"</span>")}},select:function(t,i,l){if(!(arguments.length<3)){var n=e.call(this,i);i.validate&&(this.validate=i.validate),n.inputId=CKEDITOR.tools.getNextId()+"_select",CKEDITOR.ui.dialog.labeledElement.call(this,t,i,l,function(){var e=CKEDITOR.tools.extend({},i,{id:i.id?i.id+"_select":CKEDITOR.tools.getNextId()+"_select"},!0),l=[],o=[],a={id:n.inputId,class:"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};l.push('<div class="cke_dialog_ui_input_',i.type,'" role="presentation"'),i.width&&l.push('style="width:'+i.width+'" '),l.push(">"),void 0!==i.size&&(a.size=i.size),void 0!==i.multiple&&(a.multiple=i.multiple),s(e);for(var u,d=0;d<i.items.length&&(u=i.items[d]);d++)o.push('<option value="',CKEDITOR.tools.htmlEncode(void 0!==u[1]?u[1]:u[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(u[0]));return void 0!==e.inputStyle&&(e.style=e.inputStyle),n.select=new CKEDITOR.ui.dialog.uiElement(t,e,l,"select",null,a,o.join("")),l.push("</div>"),l.join("")})}},file:function(t,i,l){if(!(arguments.length<3)){void 0===i.default&&(i.default="");var n=CKEDITOR.tools.extend(e.call(this,i),{definition:i,buttons:[]});i.validate&&(this.validate=i.validate),t.on("load",function(){CKEDITOR.document.getById(n.frameId).getParent().addClass("cke_dialog_ui_input_file")}),CKEDITOR.ui.dialog.labeledElement.call(this,t,i,l,function(){n.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var e=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" role="presentation" id="',n.frameId,'" title="',i.label,'" src="javascript:void('];return e.push(CKEDITOR.env.ie?"(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})()":"0"),e.push(')"></iframe>'),e.join("")})}},fileButton:function(t,i,l){var n=this;if(!(arguments.length<3)){e.call(this,i),i.validate&&(this.validate=i.validate);var o=CKEDITOR.tools.extend({},i),a=o.onClick;o.className=(o.className?o.className+" ":"")+"cke_dialog_ui_button",o.onClick=function(e){var l=i.for;a&&!1===a.call(this,e)||(t.getContentElement(l[0],l[1]).submit(),this.disable())},t.on("load",function(){t.getContentElement(i.for[0],i.for[1])._.buttons.push(n)}),CKEDITOR.ui.dialog.button.call(this,t,o,l)}},html:function(){var e=/^\s*<[\w:]+\s+([^>]*)?>/,t=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,i=/\/$/;return function(l,n,o){if(!(arguments.length<3)){var a,s,u=[],d=n.html;"<"!=d.charAt(0)&&(d="<span>"+d+"</span>");var r=n.focus;if(r){var c=this.focus;if(this.focus=function(){("function"==typeof r?r:c).call(this),this.fire("focus")},n.isFocusable){var h=this.isFocusable;this.isFocusable=h}this.keyboardFocusable=!0}CKEDITOR.ui.dialog.uiElement.call(this,l,n,u,"span",null,null,""),a=u.join("").match(e),s=d.match(t)||["","",""],i.test(s[1])&&(s[1]=s[1].slice(0,-1),s[2]="/"+s[2]),o.push([s[1]," ",a[1]||"",s[2]].join(""))}}}(),fieldset:function(e,t,i,l,n){var o=n.label;this._={children:t},CKEDITOR.ui.dialog.uiElement.call(this,e,n,l,"fieldset",null,null,function(){var e=[];o&&e.push("<legend"+(n.labelStyle?' style="'+n.labelStyle+'"':"")+">"+o+"</legend>");for(var t=0;t<i.length;t++)e.push(i[t]);return e.join("")})}},!0),CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement,CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(e){var t=CKEDITOR.document.getById(this._.labelId);return t.getChildCount()<1?new CKEDITOR.dom.text(e,CKEDITOR.document).appendTo(t):t.getChild(0).$.nodeValue=e,this},getLabel:function(){var e=CKEDITOR.document.getById(this._.labelId);return!e||e.getChildCount()<1?"":e.getChild(0).getText()},eventProcessors:o},!0),CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){return!this._.disabled&&this.fire("click",{dialog:this._.dialog})},enable:function(){this._.disabled=!1;var e=this.getElement();e&&e.removeClass("cke_disabled")},disable:function(){this._.disabled=!0,this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},isEnabled:function(){return!this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(e,t){this.on("click",function(){t.apply(this,arguments)})}},!0),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},focus:function(){var e=this.selectParentTab();setTimeout(function(){var t=e.getInputElement();t&&t.$.focus()},0)},select:function(){var e=this.selectParentTab();setTimeout(function(){var t=e.getInputElement();t&&(t.$.focus(),t.$.select())},0)},accessKeyUp:function(){this.select()},setValue:function(e){if(this.bidi){var t=e&&e.charAt(0),i="‪"==t?"ltr":"‫"==t?"rtl":null;i&&(e=e.slice(1)),this.setDirectionMarker(i)}return e||(e=""),CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},getValue:function(){var e=CKEDITOR.ui.dialog.uiElement.prototype.getValue.call(this);if(this.bidi&&e){var t=this.getDirectionMarker();t&&(e=("ltr"==t?"‪":"‫")+e)}return e},setDirectionMarker:function(e){var t=this.getInputElement();e?t.setAttributes({dir:e,"data-cke-dir-marker":e}):this.getDirectionMarker()&&t.removeAttributes(["dir","data-cke-dir-marker"])},getDirectionMarker:function(){return this.getInputElement().data("cke-dir-marker")},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput,CKEDITOR.ui.dialog.select.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(e,t,i){var l=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),n=this.getInputElement().$;return l.$.text=e,l.$.value=void 0===t||null===t?e:t,void 0===i||null===i?CKEDITOR.env.ie?n.add(l.$):n.add(l.$,null):n.add(l.$,i),this},remove:function(e){return this.getInputElement().$.remove(e),this},clear:function(){for(var e=this.getInputElement().$;e.length>0;)e.remove(0);return this},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(e,t){this.getInputElement().$.checked=e,!t&&this.fire("change",{value:e})},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(e,t){return!CKEDITOR.env.ie||CKEDITOR.env.version>8?o.onChange.apply(this,arguments):(e.on("load",function(){var e=this._.checkbox.getElement();e.on("propertychange",function(t){"checked"==(t=t.data.$).propertyName&&this.fire("change",{value:e.$.checked})},this)},this),this.on("change",t),null)}},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setValue:function(e,t){for(var i,l=this._.children,n=0;n<l.length&&(i=l[n]);n++)i.getElement().$.checked=i.getValue()==e;!t&&this.fire("change",{value:e})},getValue:function(){for(var e=this._.children,t=0;t<e.length;t++)if(e[t].getElement().$.checked)return e[t].getValue();return null},accessKeyUp:function(){var e,t=this._.children;for(e=0;e<t.length;e++)if(t[e].getElement().$.checked)return void t[e].getElement().focus();t[0].getElement().focus()},eventProcessors:{onChange:function(e,t){return!CKEDITOR.env.ie||CKEDITOR.env.version>8?o.onChange.apply(this,arguments):(e.on("load",function(){for(var e=this._.children,t=this,i=0;i<e.length;i++)e[i].getElement().on("propertychange",function(e){"checked"==(e=e.data.$).propertyName&&this.$.checked&&t.fire("change",{value:this.getAttribute("value")})})},this),this.on("change",t),null)}}},n,!0),CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,n,{getInputElement:function(){var e=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return e.$.forms.length>0?new CKEDITOR.dom.element(e.$.forms[0].elements[0]):this.getElement()},submit:function(){return this.getInputElement().getParent().$.submit(),this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(e){var t,i=/^on([A-Z]\w+)/;for(var l in e)(t=l.match(i))&&(this.eventProcessors[l]?this.eventProcessors[l].call(this,this._.dialog,e[l]):function(e,t,i,l){e.on("formLoaded",function(){e.getInputElement().on(i,l,e)})}(this,this._.dialog,t[1].toLowerCase(),e[l]));return this},reset:function(){function e(){i.$.open();var e="";l.size&&(e=l.size-(CKEDITOR.env.ie?7:0));var d=t.frameId+"_input";i.$.write(['<html dir="'+s+'" lang="'+u+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+s+'" lang="'+u+'" action="',CKEDITOR.tools.htmlEncode(l.action),'">','<label id="',t.labelId,'" for="',d,'" style="display:none">',CKEDITOR.tools.htmlEncode(l.label),"</label>",'<input style="width:100%" id="',d,'" aria-labelledby="',t.labelId,'" type="file" name="',CKEDITOR.tools.htmlEncode(l.id||"cke_upload"),'" size="',CKEDITOR.tools.htmlEncode(e>0?e:""),'" />',"</form>","</body></html>","<script>",CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"","window.parent.CKEDITOR.tools.callFunction("+o+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+a+")}","<\/script>"].join("")),i.$.close();for(var r=0;r<n.length;r++)n[r].enable()}var t=this._,i=CKEDITOR.document.getById(t.frameId).getFrameDocument(),l=t.definition,n=t.buttons,o=this.formLoadedNumber,a=this.formUnloadNumber,s=t.dialog._.editor.lang.dir,u=t.dialog._.editor.langCode;o||(o=this.formLoadedNumber=CKEDITOR.tools.addFunction(function(){this.fire("formLoaded")},this),a=this.formUnloadNumber=CKEDITOR.tools.addFunction(function(){this.getInputElement().clearCustomData()},this),this.getDialog()._.editor.on("destroy",function(){CKEDITOR.tools.removeFunction(o),CKEDITOR.tools.removeFunction(a)})),CKEDITOR.env.gecko?setTimeout(e,500):e()},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=""},eventProcessors:{onChange:function(e,t){this._.domOnChangeRegistered||(this.on("formLoaded",function(){this.getInputElement().on("change",function(){this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",t)}},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button,CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype),CKEDITOR.dialog.addUIElement("text",t),CKEDITOR.dialog.addUIElement("password",t),CKEDITOR.dialog.addUIElement("textarea",i),CKEDITOR.dialog.addUIElement("checkbox",i),CKEDITOR.dialog.addUIElement("radio",i),CKEDITOR.dialog.addUIElement("button",i),CKEDITOR.dialog.addUIElement("select",i),CKEDITOR.dialog.addUIElement("file",i),CKEDITOR.dialog.addUIElement("fileButton",i),CKEDITOR.dialog.addUIElement("html",i),CKEDITOR.dialog.addUIElement("fieldset",l)}});